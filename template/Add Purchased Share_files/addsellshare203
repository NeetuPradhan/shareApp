var AddShare={commissionSetting:{},bindDatepicker:function(){$("#txtTransactionDateAD").datepicker({changeMonth:!0,changeYear:!0,onSelect:function(){return AddShare.getMiti(),$("#txtTransactionDateBS").focus(),!1}})},getMiti:function(){var n=$("#txtTransactionDateAD").val();n!=""&&dateToMiti(n,"txtTransactionDateBS")},getDate:function(){var n=$("#txtTransactionDateBS").val();n!=""&&mitiToDate(n,"txtTransactionDateAD")},clearAddShare:function(){$("#ddlShareType").val("0");$("#txtTransactionDateAD").val("");$("#txtTransactionDateBS").val("");$("#divContent > #divContentRow").each(function(){$(this).find("input[type='text']").each(function(){$(this).val("")}).end().find("select").each(function(){$(this).val("0")})})},checkShareType:function(){var t=$("#ddlShareType").val(),n=$("#pnlAddShare");t==0||t==1?(n.find("div.transaction-number").show(),n.find("div.broker").show(),n.find("div.rate").show()):(t==2||t==3||t==4)&&(n.find("div.transaction-number").hide(),n.find("div.transaction-number #txtTransactionNumber").val(""),n.find("div.broker").hide(),n.find("div.broker #ddlBroker").val("0"),t==4?(n.find("div.rate").hide(),n.find("div.rate #txtRate").val("")):n.find("div.rate").show())},refreshPurchaseSerialNumber:function(){var n=0;$("#divContent > #divContentRow").each(function(t){n=t+1;$(this).find("#serialNumber").eq(0).text(n+".")})},setFocus:function(n){var t=$("#ddlShareType").val();t==0||t==1?$(n).find("#txtTransactionNumber").focus():$(n).find("#"+ClientID_AddShare.ASSymbol).eq(0).focus()},addPurchaseTransaction:function(){var n=$("#divContent > #divContentRow:last()"),t=n.find("#ddlBroker").val(),i=n.find("#ddlPortfolio").val(),r=n.find("#ddlShareholder").val();n=n.clone();n.find("input[type='text']").each(function(){$(this).val("");removeHighlightByElement(this)}).end().find("select").each(function(){console.log;switch($(this).attr("id")){case"ddlBroker":$(this).val(t);break;case"ddlPortfolio":$(this).val(i);break;case"ddlShareholder":$(this).val(r)}removeHighlightByElement(this)}).end().find("input[type='hidden']").each(function(){$(this).val("0")}).end().find("autosuggest input[type='text']").each(function(){AutoSuggest.getAutoSuggestDataAll("Company",this)});$("#divContent").append(n);AddShare.setFocus(n);AddShare.refreshPurchaseSerialNumber()},deletePurchaseTransaction:function(n){var t=$("#divContent  #divContentRow").length;confirm("Are you sure you want to delete this transaction ?")&&(t==1&&AddShare.addPurchaseTransaction(),$(n).closest("#divContentRow").remove());AddShare.setFocus($("#divContent #divContentRow").last());AddShare.refreshPurchaseSerialNumber()},validateAddShare:function(n){var u=$(n).attr("onclick"),t,i,r;return $(n).attr("onclick","return false;"),$("#divError").hide(),t="",i=!0,validateDropdownById("ddlShareType",0)||(t+="<li>Share Type is required<\/li>"),validateStringById("txtTransactionDateAD")||(t+="<li>Transaction Date AD is required<\/li>"),$("#txtTransactionDateAD").val().trim()==""||validateDateADById("txtTransactionDateAD")||(t+="<li>Transaction Date AD is invalid. Must be mm/dd/yyyy"),validateStringById("txtTransactionDateBS")||(t+="<li>Transaction Date BS is required<\/li>"),$("#txtTransactionDateBS").val().trim()==""||validateDateBSById("txtTransactionDateBS")||(t+="<li>Transaction Date BS is invalid. Must be yyyy/mm/dd"),r=$("#ddlShareType",0).val(),t+=AddShare.validateTransactions(r),t!=""?($(n).attr("onclick",u),showValidationError("divError","Could not save purchased shares due to following errors:","<ul>"+t+"<\/ul"),i=!1):(AddShare.getPurchaseTransactions(r),showProcessing()),i},validateTransactions:function(n){var t,i,r;return n!=0?(t="",i=!0,$("#divContent > #divContentRow").each(function(r){i=!0;n==1;n==4||validateAmountByElement($(this).find("#txtRate").eq(0))||(i=!1);validateQuantityByElement($(this).find("#txtQuantity").eq(0))||(i=!1);validateAutoSuggestByElement($(this).find("#"+ClientID_AddShare.ASSymbol).eq(0))||(i=!1);validateDropdownByElement($(this).find("#ddlPortfolio").eq(0),0)||(i=!1);validateDropdownByElement($(this).find("#ddlShareholder").eq(0),0)||(i=!1);i==!1&&(t+=r+1+", ")}),t!="")?(t=t.trim(),t=t.substring(0,t.length-1),r=t.split(",").length,"<li>Transaction "+(r>1?"entries ":"entry ")+t+(r>1?" are ":" is ")+"invalid<\/li>"):"":""},getPurchaseTransactions:function(n){var t=document.getElementById("hdnTransactionDetail");t.value="";n!=0&&($("#divContent > #divContentRow").each(function(){t.value+=(n==1?$(this).find("#txtTransactionNumber").eq(0).val():"")+"|";t.value+=$(this).find("#"+ClientID_AddShare.ASSymbol).eq(0).parent().find("input[type='hidden']:eq(0)").val()+"|";t.value+=$(this).find("#"+ClientID_AddShare.ASSymbol).eq(0).val()+"|";t.value+=$(this).find("#txtQuantity").eq(0).val()+"|";t.value+=(n!=4?$(this).find("#txtRate").eq(0).val():"0")+"|";t.value+=(n==1?$(this).find("#ddlBroker").eq(0).val():"0")+"|";t.value+=$(this).find("#ddlPortfolio").eq(0).val()+"|";t.value+=$(this).find("#ddlShareholder").eq(0).val()+"|";t.value=t.value.substring(0,t.value.length-1)+";"}),t.value=t.value.substring(0,t.value.length-1))},fillPurchaseTransactions:function(){var r,t,f,e,n,i,u;for(AddShare.checkShareType(),r=$("#hdnTransactionDetail").val().split(";"),f=r.length,i=0;i<f;i++){for(i!=0&&AddShare.addPurchaseTransaction(),t=r[i].split("|"),e=t.length,n=$("#divContent > #divContentRow").last(),u=0;u<e;u++)n.find("#txtTransactionNumber").eq(0).val(t[0]),n.find("#"+ClientID_AddShare.ASSymbol).eq(0).parent().find("input[type='hidden']:eq(0)").val(t[1]),n.find("#"+ClientID_AddShare.ASSymbol).eq(0).val(t[2]),n.find("#txtQuantity").eq(0).val(t[3]),n.find("#txtRate").eq(0).val(t[4]),n.find("#ddlBroker").eq(0).val(t[5]),n.find("#ddlPortfolio").eq(0).val(t[6]),n.find("#ddlShareholder").eq(0).val(t[7]),n.find("#hdnAmount:eq(0)").val("0"),n.find("#hdnBrokerCommission:eq(0)").val("0"),n.find("#hdnSeboCommission:eq(0)").val("0"),n.find("#hdnPurchaseCost:eq(0)").val("0");AddShare.calculateAmount(n.find("#txtQuantity:eq(0)"))}AddShare.showTotal()},showTotal:function(){var a=$("#ddlShareType").val(),f=parseInt(0),n="",t,e=parseFloat(0),i="",r,u=0,l=parseFloat(0),o=parseFloat(0),s=parseFloat(0),h=parseFloat(0),c;$("#divContent > #divContentRow").each(function(){t=parseInt(0);n=$(this).find("#txtQuantity:eq(0)").val();n!=""&&(t=parseInt(n));f+=t;r=parseFloat(0);i=$(this).find("#txtRate:eq(0)").val();i!=""&&(u++,r=parseFloat(i));e+=r;l+=parseFloat(parseFloat($(this).find("#hdnAmount:eq(0)").val()).toFixed(2));o+=parseFloat(parseFloat($(this).find("#hdnBrokerCommission:eq(0)").val()).toFixed(2));s+=parseFloat(parseFloat($(this).find("#hdnSeboCommission:eq(0)").val()).toFixed(2));h+=parseFloat(parseFloat($(this).find("#hdnPurchaseCost:eq(0)").val()).toFixed(2))});$("#totalQuantity").text(formatNumber(f,0,!1));c=u==0?0:parseFloat(e/u).toFixed(2);$("#avgRate").text(formatNumber(c,2,!1));$("#brokerCommission").text(formatNumber(o,2,!1));$("#seboCommission").text(formatNumber(s,2,!1));$("#purchaseCost").text(formatNumber(h,2,!1))},getCommissionSetting:function(){var n=$("#txtTransactionDateAD").val();if(n==""){AddShare.commissionSetting={};AddShare.calculateAllAmount();AddShare.showTotal();return}$.ajax({url:"/handlers/webrequesthandler.ashx?type=commission_setting",type:"POST",data:{dateAD:n},dataType:"json",success:function(n){n.MsgType=="ok"&&(AddShare.commissionSetting=n,AddShare.calculateAllAmount(),AddShare.showTotal())},error:function(n,t,i){console.log("Ajax Error: "+i)}})},calculateAllAmount:function(){$("#divContent > #divContentRow").each(function(){AddShare.calculateAmount(this)})},calculateAmount:function(n){var r=$("#ddlShareType").val(),t=$(n).closest("#divContentRow"),s=parseInt(t.find("#txtQuantity:eq(0)").val()==""?0:t.find("#txtQuantity:eq(0)").val()),h=parseFloat(t.find("#txtRate:eq(0)").val()==""?0:t.find("#txtRate:eq(0)").val()),i=parseFloat(0),u=parseFloat(0),f=parseFloat(0),e=parseFloat(0),o=parseFloat(0);r!=0&&$.isEmptyObject(AddShare.commissionSetting)==!1&&(r!=4&&(i=parseFloat(parseFloat(s*h).toFixed(2))),r==1&&(f=AddShare.calculateBrokerCommission(i),u=AddShare.calculateSeboCommission(i),o=AddShare.calculateNameTransferAmount(i)),e=parseFloat(parseFloat(i+u+f+o).toFixed(2)).toFixed(2));t.find("#hdnAmount:eq(0)").val(i);t.find("#hdnBrokerCommission:eq(0)").val(f);t.find("#hdnSeboCommission:eq(0)").val(u);t.find("#hdnPurchaseCost:eq(0)").val(e)},calculateBrokerCommission:function(n){var t,r,u,i,f;if(n==0)return 0;if(t=AddShare.commissionSetting.BrokerCommissionRate,r=AddShare.commissionSetting.MinimumCommissionAmount,t.length>0&&r.length>0){for(u=parseFloat(0),i=0;i<t.length;i++)n>=t[i].StartAmount&&n<=t[i].EndAmount&&(u=t[i].BrokerCommissionRate);return u==0?0:(f=parseFloat(parseFloat(n*u).toFixed(2)),f<parseFloat(r[0].MinimumCommissionAmount)&&(f=parseFloat(r[0].MinimumCommissionAmount)),f)}return 0},calculateSeboCommission:function(n){var t,i,r;return n==0?0:(t=AddShare.commissionSetting.SeboCommissionRate,t.length>0)?(i=parseFloat(t[0].SeboCommissionRate),r=parseFloat(parseFloat(n*i).toFixed(2)),r):0},calculateNameTransferAmount:function(n){var t;return n==0?0:(t=AddShare.commissionSetting.NameTransferAmount,t.length>0)?parseFloat(parseFloat(t[0].NameTransferAmount).toFixed(2)):0}},SellShare={row:null,commissionSetting:{},selectionHistory:[],bindDatepicker:function(){$("#txtTransactionDateAD").datepicker({changeMonth:!0,changeYear:!0,onSelect:function(){return SellShare.getMiti(),$("#txtTransactionDateBS").focus(),!1}})},getMiti:function(){var n=$("#txtTransactionDateAD").val();n!=""&&dateToMiti(n,"txtTransactionDateBS")},getDate:function(){var n=$("#txtTransactionDateBS").val();n!=""&&mitiToDate(n,"txtTransactionDateAD")},refreshSellSerialNumber:function(){var n=0;$("#divContent > #divContentRow").each(function(t){n=t+1;$(this).find("#serialNumber").eq(0).text(n+".")})},addSellTransaction:function(n){var t=$("#divContent > #divContentRow:last()"),i=t.find("#ddlBroker").val(),t=t.clone();t.find("input[type='text']").each(function(){$(this).val("").removeAttr("disabled");removeHighlightByElement(this)}).end().find("select").each(function(){$(this).attr("id")=="ddlBroker"&&$(this).val(i);removeHighlightByElement(this)}).end().find("input[type='hidden']").each(function(){$(this).val("0")}).end().find("a").each(function(){$(this).removeAttr("disabled")}).end().find("#txtQuantity:eq(0)").attr("disabled","disabled").end().find("#hdnPurchase:eq(0)").val("").end().find("autosuggest input[type='text']").each(function(){AutoSuggest.getAutoSuggestDataAll("Company",this)});n==null?($("#divContent").append(t),$(t).find("#txtTransactionNumber:eq(0)").focus()):($(n).after(t),SellShare.row=t);SellShare.refreshSellSerialNumber()},deleteSellTransaction:function(n){var t=$("#divContent  #divContentRow").length;confirm("Are you sure you want to delete this transaction ?")&&(t==1&&SellShare.addSellTransaction(null),$(n).closest("#divContentRow").remove(),$("#divContent #divContentRow").last().find("#txtTransactionNumber:eq(0)").focus());SellShare.refreshSellSerialNumber()},showSellShare:function(){$("#divSellShare").show();$("#divBalanceShares").hide();SellShare.showTotal()},getSelectionHistory:function(){SellShare.selectionHistory=[];var n,t,i;$("#divContent > #divContentRow").each(function(){if(n=$(this).find("#hdnPurchase:eq(0)").val(),n!=""){t=n.split("|");i=t.length;for(var r=0;r<i;r++)SellShare.selectionHistory.push($.parseJSON(t[r]))}})},clearBalanceShares:function(){$("#divBalanceError").hide();var n=$("#divBalanceShares #symbol").html("").attr("title","");document.getElementById("chkSelectAll").checked=!1;$("#balanceShares tr:gt(0)").each(function(n){n!=0?$(this).remove():($(this).find("input[type='text']").each(function(){removeHighlightByElement(this)}),deselectRow(this))})},addBalanceShare:function(){var n=$("#balanceShares tr:last()").clone();n.find("input[type='text']").each(function(){$(this).val("");removeHighlightByElement(this)}).end().find("input[type='hidden']").each(function(){$(this).val("0")}).end().find("input[type='checkbox']").each(function(){$(this).removeAttr("checked")});$("#balanceShares").append(n)},updateBalanceShares:function(n){var u=n.length,f=SellShare.selectionHistory.length,e=0,r=0,o=0,t=0,i=0;if(f>0)for(t=0;t<u;t++)for(e=n[t].UserTransactionID,r=parseInt(n[t].RemainingQuantity),i=0;i<f;i++)e==SellShare.selectionHistory[i].PurchaseTransactionID&&(o=parseInt(SellShare.selectionHistory[i].Quantity),r-=o,n[t].RemainingQuantity=r,r==0&&(n.splice(t,1),u--,t--))},showBalanceShares:function(n){for(var f=$("#divBalanceShares #symbol").html(n[0].StockSymbol).attr("title",n[0].CompanyName),r=$("#balanceShares"),i,u=n.length,t=0;t<u;t++)t!=0&&SellShare.addBalanceShare(),i=r.find("tr:last()"),i.find("#chkSelect:eq(0)").removeAttr("checked"),i.find("#hdnUserTransactionID:eq(0)").val(n[t].UserTransactionID),i.find("#hdnShareTypeID:eq(0)").val(n[t].ShareTypeID),i.find("#hdnGainTaxRate:eq(0)").val(parseInt(n[t].TaxExempted)==1?0:n[t].CapitalGainTaxRate),i.find("#shareType:eq(0)").html(n[t].ShareTypeCode).attr("title",n[t].ShareTypeName),i.find("#dateAD:eq(0)").html(n[t].TransactionDateAD),i.find("#dateBS:eq(0)").html(n[t].TransactionDateBS),i.find("#transactionNumber:eq(0)").html(n[t].TransactionNumber),i.find("#quantity:eq(0)").html(n[t].Quantity),i.find("#balanceQuantity:eq(0)").html(n[t].RemainingQuantity),i.find("#rate:eq(0)").html(formatNumber(n[t].Rate,2,!1)),i.find("#broker:eq(0)").html(n[t].BrokerCode),i.find("#portfolio:eq(0)").html(n[t].PortfolioName),i.find("#shareholder:eq(0)").html(n[t].ShareholderName),i.find("#txtSalesQty:eq(0)").val(""),i.find("#hdnBasePrice:eq(0)").val(n[t].BasePrice);$("#totalQtySelected:eq(0)").text("0")},searchPurchaseTransaction:function(n,t){SellShare.row=$(n).closest("#divContentRow");var i=SellShare.row.find("#"+ClientID_SellShare.ASSymbol).parent().find("input[type='hidden']:eq(0)").val();if(i==0){hideProcessing();SellShare.row.find("#"+ClientID_SellShare.ASSymbol).parent().find("input[type='text']:eq(0)").focus();alert("Please select a symbol");return}SellShare.getSelectionHistory();$.ajax({url:"/handlers/purchasehandler.ashx?type=balanceshares",type:"POST",data:{userID:t,companyID:i},dataType:"json",success:function(n){n!=null&&n.msgType=="ok"?(SellShare.clearBalanceShares(),SellShare.updateBalanceShares(n.balanceShares),$("#divSellShare").hide(),$("#divBalanceShares").show(),SellShare.showBalanceShares(n.balanceShares),hideProcessing()):(hideProcessing(),alert("Selected symbol has no balance shares"))},error:function(){hideProcessing();alert("Could not get balance shares for selected symbol")}})},selectAll:function(n){$("#balanceShares tr:gt(0) #chkSelect").each(function(){this.checked=n.checked;SellShare.selectTransaction(this)})},selectTransaction:function(n){var t=$(n).closest("tr"),i;n.checked?(selectRow(t),i=t.find("#txtSalesQty:eq(0)"),$(i).val().trim()==""&&$(i).val(t.find("#balanceQuantity").html())):deselectRow(t)},validateSelection:function(){var n="",u=0,f=0,i=0,r,t;return($("#balanceShares tr:gt(0)").each(function(e){$(this).find("#chkSelect:eq(0)").is(":checked")&&(i++,r=$(this).find("#balanceQuantity:eq(0)"),t=$(this).find("#txtSalesQty:eq(0)"),validateQuantityByElement(t)?(u=$(r).html()==""?parseInt(0):parseInt($(r).html().toString().replace(",","")),f=$(t).val()==""?parseInt(0):parseInt($(t).val().toString().replace(",","")),f>u?(n+=e+1+", ",highlightErrorByElement(t)):removeHighlightByElement(t)):n+=e+1+", ")}),i==0)?"<li>You must select at least one item for selling<\/li>":n!=""?(n=n.trim(),n=n.substring(0,n.length-1),i=n.split(",").length,"<li>Invalid sales quantity for "+(i>1?"items ":"item ")+n+"<\/li>"):""},validateEntries:function(){var n="";return(n+=SellShare.validateSelection(),n!="")?(showValidationError("divBalanceError","Could not confirm selection due to following errors:","<ul>"+n+"<\/ul"),!1):!0},removeFormat:function(n){return n.split(",").join("")},confirmSelection:function(n){var r=$(n).attr("onclick"),i,t;$(n).attr("onclick","");SellShare.validateEntries()==!0&&(i=parseInt(0),t=SellShare.row.find("#hdnPurchase:eq(0)"),t.val(""),$("#balanceShares tr:gt(0)").each(function(){$(this).find("#chkSelect:eq(0)").is(":checked")&&(i+=parseInt($(this).find("#txtSalesQty:eq(0)").val()),t.val(t.val()+'{"PurchaseTransactionID":"'+$(this).find("#hdnUserTransactionID:eq(0)").val()+'",'),t.val(t.val()+'"ShareTypeID":"'+$(this).find("#hdnShareTypeID:eq(0)").val()+'",'),t.val(t.val()+'"GainTaxRate":"'+$(this).find("#hdnGainTaxRate:eq(0)").val()+'",'),t.val(t.val()+'"Rate":"'+($(this).find("#rate:eq(0)").text()==""?0:SellShare.removeFormat($(this).find("#rate:eq(0)").text()))+'",'),t.val(t.val()+'"BasePrice":"'+($(this).find("#hdnBasePrice:eq(0)").val()==""?0:$(this).find("#hdnBasePrice:eq(0)").val())+'",'),t.val(t.val()+'"Quantity":"'+$(this).find("#txtSalesQty:eq(0)").val()+'"}|'))}),t.val(t.val().substring(0,t.val().length-1)),SellShare.row.find("#lnkSearch:eq(0)").attr("disabled","disabled"),SellShare.row.find("#txtQuantity:eq(0)").val(i).attr("disabled","disabled"),SellShare.showSellShare(),SellShare.row.find("#txtRate:eq(0)").focus());$(n).attr("onclick",r);hideProcessing()},validateSellShare:function(n){var r=$(n).attr("onclick"),t,i;return $(n).attr("onclick","return false;"),$("#divError").hide(),t="",i=!0,validateStringById("txtTransactionDateAD")||(t+="<li>Transaction Date AD is required<\/li>"),$("#txtTransactionDateAD").val().trim()==""||validateDateADById("txtTransactionDateAD")||(t+="<li>Transaction Date AD is invalid. Must be mm/dd/yyyy"),validateStringById("txtTransactionDateBS","")||(t+="<li>Transaction Date BS is required<\/li>"),$("#txtTransactionDateBS").val().trim()==""||validateDateBSById("txtTransactionDateBS")||(t+="<li>Transaction Date BS is invalid. Must be yyyy/mm/dd"),t+=SellShare.validateTransactions(),t!=""?($(n).attr("onclick",r),showValidationError("divError","Could not save sold shares due to following errors","<ul>"+t+"<\/ul"),i=!1):(SellShare.getSellTransactions(),showProcessing()),i},validateTransactions:function(){var n="",t=!0,i;return($("#divContent > #divContentRow").each(function(i){t=!0;validateAutoSuggestByElement($(this).find("#"+ClientID_SellShare.ASSymbol))||(t=!1);validateQuantityByElement($(this).find("#txtQuantity:eq(0)"))||(t=!1);validateAmountByElement($(this).find("#txtRate:eq(0)"))||(t=!1);t==!1&&(n+=i+1+", ")}),n!="")?(n=n.trim(),n=n.substring(0,n.length-1),i=n.split(",").length,"<li>Transaction "+(i>1?"entries ":"entry ")+n+(i>1?" are ":" is ")+"invalid"):""},getSellTransactions:function(){var n=document.getElementById("hdnTransactionDetail"),t;n.value="[";t="";$("#divContent > #divContentRow").each(function(){n.value+='{"TransactionNumber":"'+$(this).find("#txtTransactionNumber:eq(0)").val()+'",';n.value+='"CompanyID":"'+$(this).find("#"+ClientID_SellShare.ASSymbol).parent().find("input[type='hidden']:eq(0)").val()+'",';n.value+='"Symbol":"'+$(this).find("#"+ClientID_SellShare.ASSymbol).val()+'",';n.value+='"Quantity":"'+$(this).find("#txtQuantity:eq(0)").val()+'",';n.value+='"Rate":"'+$(this).find("#txtRate:eq(0)").val()+'",';n.value+='"BrokerID":"'+$(this).find("#ddlBroker:eq(0)").val()+'",';t=$(this).find("#txtGainTax:eq(0)").val();n.value+='"CapitalGainTax":"'+(t==""?"0":t)+'",';n.value+='"Purchase":['+$(this).find("#hdnPurchase:eq(0)").val().replace(/\|/g,",")+"]},"});n.value=n.value.substring(0,n.value.length-1)+"]"},fillSellTransactions:function(){for(var r=$.parseJSON($("#hdnTransactionDetail").val()),o=r.length,n,e,t,f,u,i=0;i<r.length;i++){for(i!=0&&SellShare.addSellTransaction(),n=$("#divContent > #divContentRow").last(),n.find("#txtTransactionNumber:eq(0)").val(r[i].TransactionNumber),n.find("#"+ClientID_SellShare.ASSymbol).parent().find("input[type='hidden']:eq(0)").val(r[i].CompanyID),n.find("#"+ClientID_SellShare.ASSymbol).val(r[i].Symbol),n.find("#txtQuantity:eq(0)").val(r[i].Quantity).attr("disabled","disabled"),n.find("#txtRate:eq(0)").val(r[i].Rate),n.find("#ddlBroker:eq(0)").val(r[i].BrokerID),n.find("#txtGainTax:eq(0)").val(r[i].CapitalGainTax),n.find("#hdnAmount:eq(0)").val("0"),n.find("#hdnBrokerCommission:eq(0)").val("0"),n.find("#hdnSeboCommission:eq(0)").val("0"),n.find("#hdnSalesRevenue:eq(0)").val("0"),n.find("#hdnGainTax:eq(0)").val("0"),f=r[i].Purchase,t=n.find("#hdnPurchase"),e=f.length,t.val(""),u=0;u<e;u++)t.val(t.val()+'{"PurchaseTransactionID":"'+f[u].PurchaseTransactionID+'",'),t.val(t.val()+'"ShareTypeID":"'+f[u].ShareTypeID+'",'),t.val(t.val()+'"GainTaxRate":"'+f[u].GainTaxRate+'",'),t.val(t.val()+'"Rate":"'+f[u].Rate+'",'),t.val(t.val()+'"Quantity":"'+f[u].Quantity+'"}|');t.val(t.val().substring(0,t.val().length-1));SellShare.calculateAmount(n.find("#txtQuantity:eq(0)"),!1)}SellShare.showTotal()},showSelectedTotal:function(){var i=parseInt(0),n="",t=parseInt(0);$("#balanceShares tr:gt(0)").each(function(){t=0;n=$(this).find("#txtSalesQty:eq(0)").val();n!=""&&$(this).find("#chkSelect:eq(0)").is(":checked")&&(t=parseInt(n));i+=t});$("#totalQtySelected").text(formatNumber(i,0,!1))},showTotal:function(){var f=parseInt(0),n="",t=parseInt(0),e=parseFloat(0),i="",r,u=0,a=parseFloat(0),o=parseFloat(0),s=parseFloat(0),h=parseFloat(0),c=parseFloat(0),v=parseFloat(0),y=parseFloat(0),l;$("#divContent > #divContentRow").each(function(){t=parseInt(0);n=$(this).find("#txtQuantity:eq(0)").val();n!=""&&(t=parseInt(n));f+=t;r=parseFloat(0);i=$(this).find("#txtRate:eq(0)").val();i!=""&&(u++,r=parseFloat(i));e+=r;h+=parseFloat(parseFloat($(this).find("#txtGainTax:eq(0)").val()==""?0:$(this).find("#txtGainTax:eq(0)").val()).toFixed(2));a+=parseFloat(parseFloat($(this).find("#hdnAmount:eq(0)").val()).toFixed(2));o+=parseFloat(parseFloat($(this).find("#hdnBrokerCommission:eq(0)").val()).toFixed(2));s+=parseFloat(parseFloat($(this).find("#hdnSeboCommission:eq(0)").val()).toFixed(2));c+=parseFloat(parseFloat($(this).find("#hdnSalesRevenue:eq(0)").val()).toFixed(2))});$("#totalQuantity").text(formatNumber(f,0,!1));l=u==0?0:parseFloat(e/u).toFixed(2);$("#avgRate").text(formatNumber(l,2,!1));$("#brokerCommission").text(formatNumber(o,2,!1));$("#seboCommission").text(formatNumber(s,2,!1));$("#gainTax").text(formatNumber(h,2,!1));$("#salesRevenue").text(formatNumber(c,2,!1))},getCommissionSetting:function(){var n=$("#txtTransactionDateAD").val();if(n==""){SellShare.commissionSetting={};SellShare.calculateAllAmount();SellShare.showTotal();return}$.ajax({url:"/handlers/webrequesthandler.ashx?type=commission_setting",type:"POST",data:{dateAD:n},dataType:"json",success:function(n){n.MsgType=="ok"&&(SellShare.commissionSetting=n,SellShare.calculateAllAmount(),SellShare.showTotal())},error:function(n,t,i){console.log("Ajax Error: "+i)}})},calculateAllAmount:function(){$("#divContent > #divContentRow").each(function(){SellShare.calculateAmount(this,!0)})},calculateAmount:function(n,t){var i=$(n).closest("#divContentRow"),s=parseInt(i.find("#txtQuantity:eq(0)").val()==""?0:i.find("#txtQuantity:eq(0)").val()),h=parseFloat(i.find("#txtRate:eq(0)").val()==""?0:i.find("#txtRate:eq(0)").val()),r=parseFloat(i.find("#txtGainTax:eq(0)").val()==""?0:i.find("#txtGainTax:eq(0)").val()),u=parseFloat(0),e=parseFloat(0),o=parseFloat(0),f=parseFloat(0),c=parseFloat(0);$.isEmptyObject(SellShare.commissionSetting)==!1&&(u=parseFloat(parseFloat(s*h).toFixed(2)),o=SellShare.calculateBrokerCommission(u),e=SellShare.calculateSeboCommission(u),f=parseFloat(parseFloat(u-e-o).toFixed(2)),r=t?SellShare.calculateGainTax(i.find("#hdnPurchase:eq(0)").val(),f):r,f=parseFloat(parseFloat(f-r).toFixed(2)));i.find("#hdnAmount:eq(0)").val(u);i.find("#hdnBrokerCommission:eq(0)").val(o);i.find("#hdnSeboCommission:eq(0)").val(e);i.find("#hdnSalesRevenue:eq(0)").val(f);i.find("#txtGainTax:eq(0)").val(r==0?"":r)},calculateGainTax:function(n,t){var i;if(n=="")return 0;var u=parseFloat(0),e=parseFloat(0),o=parseFloat(0),h=parseFloat(0),s=parseFloat(0),a=parseFloat(0),c=parseFloat(0),r=$.parseJSON("["+n.replace(/\|/g,",")+"]"),l=r.length,f=0;for(i=0;i<l;i++)f=r[i].ShareTypeID,f==1||f==2?u=parseFloat(r[i].Quantity)*parseFloat(r[i].Rate):(f==3||f==4)&&(u=parseFloat(r[i].Quantity)*parseFloat(r[i].BasePrice)),f==1?(o=SellShare.calculateBrokerCommission(u),e=SellShare.calculateSeboCommission(u),nameTransferAmt=SellShare.calculateNameTransferAmount(u)):(o=0,e=0,nameTransferAmt=0),h+=parseFloat(parseFloat(u+e+o+nameTransferAmt).toFixed(2));return s=parseFloat(parseFloat(t-h).toFixed(2)),c=parseFloat(r[0].GainTaxRate),s>0?parseFloat(parseFloat(s*c).toFixed(2)):parseFloat(0)},calculateBrokerCommission:function(n){var t,r,u,i,f;if(n==0)return 0;if(t=SellShare.commissionSetting.BrokerCommissionRate,r=SellShare.commissionSetting.MinimumCommissionAmount,t.length>0&&r.length>0){for(u=parseFloat(0),i=0;i<t.length;i++)n>=t[i].StartAmount&&n<=t[i].EndAmount&&(u=t[i].BrokerCommissionRate);return u==0?0:(f=parseFloat(parseFloat(n*u).toFixed(2)),f<parseFloat(r[0].MinimumCommissionAmount)&&(f=parseFloat(r[0].MinimumCommissionAmount)),f)}return 0},calculateSeboCommission:function(n){var t,i,r;return n==0?0:(t=SellShare.commissionSetting.SeboCommissionRate,t.length>0)?(i=parseFloat(t[0].SeboCommissionRate),r=parseFloat(parseFloat(n*i).toFixed(2)),r):0},calculateNameTransferAmount:function(n){var t;return n==0?0:(t=SellShare.commissionSetting.NameTransferAmount,t.length>0)?parseFloat(parseFloat(t[0].NameTransferAmount).toFixed(2)):0}}