var MyPortfolio={commissionSetting:{},showDetail:function(n){$("#"+ClientID_MyPortfolio.hdnPortfolioDetail).val(n);$("#"+ClientID_MyPortfolio.btnShowDetail).click()},getCommissionSetting:function(){console.log("Get commission setting");var n=new Date,t=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();$.ajax({url:"/handlers/webrequesthandler.ashx?type=commission_setting",type:"GET",data:{dateAD:t},dataType:"json",success:function(n){n.MsgType=="ok"&&(MyPortfolio.commissionSetting=n)},error:function(n,t,i){console.log("Ajax Error: "+i)}})},formatData:function(n,t,i,r,u,f,e,o,s){var h,c;n.find("#ltp:eq(0)").text(formatNumber(t,2,!1));h=n.find("#priceChange:eq(0)");h.text(formatNumber(i,2,!1));i>0?h.attr("class","text-increase"):i<0?h.attr("class","text-decrease"):h.attr("class","");c=n.find("#percentChange:eq(0)");c.text("("+formatNumber(r,4,!0)+"%)");r>0?c.attr("class","text-increase"):r<0?c.attr("class","text-decrease"):c.attr("class","");n.find("#ltpGain:eq(0)").text(formatNumber(u,2,!1));n.find("#percentLtpGain:eq(0)").text("("+formatNumber(f,4,!0)+"%)");$ltpGainContainer=n.find("#ltpGainContainer:eq(0)");u>0?$ltpGainContainer.attr("class","text-increase"):u<0?$ltpGainContainer.attr("class","text-decrease"):$ltpGainContainer.attr("class","");n.find("#overallGain:eq(0)").text(formatNumber(e,2,!1));n.find("#percentOverallGain:eq(0)").text("("+formatNumber(o,4,!0)+"%)");$overallGainContainer=n.find("#overallGainContainer:eq(0)");e>0?$overallGainContainer.attr("class","text-increase"):e<0?$overallGainContainer.attr("class","text-decrease"):$overallGainContainer.attr("class","");n.find("#portfolioValue:eq(0)").text(formatNumber(s,2,!1))},bindPortfolio:function(n){if($("#"+ClientID_MyPortfolio.hdnBindLivePortfolio).val()==1&&$.isEmptyObject(MyPortfolio.commissionSetting)==!1){console.log("binding live portfolio");var ht=$("#"+ClientID_MyPortfolio.tblPortfolio),y="",i=parseFloat(0),p=parseFloat(0),ut=parseFloat(0),e={},w="",s=parseInt(0),r=parseFloat(0),b,h,k={},d=parseFloat(0),c=parseFloat(0),ft=parseFloat(0),l=parseFloat(0),et=parseFloat(0),o=parseFloat(0),u=parseFloat(0),g=parseFloat(0),t=parseFloat(0),f=parseFloat(0),nt=parseFloat(0),ot=parseFloat(0),st=parseFloat(0),tt,it,rt,a,v,o=isNaN(parseFloat($("#"+ClientID_MyPortfolio.lblInvestmentFiltered).text().split(",").join("")))?0:parseFloat($("#"+ClientID_MyPortfolio.lblInvestmentFiltered).text().split(",").join(""));ht.find("tr:gt(0)").each(function(){b=$(this).find("#balanceQty:eq(0)");s=isNaN(parseInt(b.text().split(",").join("")))?0:parseInt(b.text().split(",").join(""));h=$(this).find("#balanceCost:eq(0)");r=h.text().trim()==""||isNaN(parseFloat(h.text().split(",").join("")))?0:parseFloat(h.text().split(",").join(""));u=parseFloat(0);g=parseFloat(0);t=parseFloat(0);f=parseFloat(0);nt=parseFloat(0);k={};y=$(this).find("#symbol:eq(0)").text();n.hasOwnProperty(y)?(e=n[y],i=e.LTP,p=parseFloat(e.PriceChange),ut=parseFloat(e.PercentChange),w=e.DateTime,s>0&&(k=Calculator.calculateSalesRevenue(s,i,MyPortfolio.commissionSetting,0),u=parseFloat(parseFloat(p*s).toFixed(2)),g=r>0?parseFloat(parseFloat(u/r*100).toFixed(2)):0,t=parseFloat(k.revenue),f=t>0?parseFloat(parseFloat(t-r).toFixed(2)):0,nt=t>0?r>0?parseFloat(parseFloat(f/r*100).toFixed(2)):0:0),MyPortfolio.formatData($(this),i,p,ut,u,g,f,nt,t),a=$(this).find("#fiftyTwoWeekHigh:eq(0)"),ot=isNaN(parseFloat(a.text().split(",").join("")))?0:parseFloat(a.text().split(",").join("")),i>ot&&a.text(formatNumber(i,2,!1)),v=$(this).find("#fiftyTwoWeekLow:eq(0)"),st=isNaN(parseFloat(v.text().split(",").join("")))?0:parseFloat(v.text().split(",").join("")),i<st&&v.text(formatNumber(i,2,!1))):(tt=$(this).find("#portfolioValue:eq(0)"),t=isNaN(parseFloat(tt.text().split(",").join("")))?0:parseFloat(tt.text().split(",").join("")),it=$(this).find("#ltpGain:eq(0)"),u=isNaN(parseFloat(it.text().split(",").join("")))?0:parseFloat(it.text().split(",").join("")),rt=$(this).find("#overallGain:eq(0)"),f=isNaN(parseFloat(rt.text().split(",").join("")))?0:parseFloat(rt.text().split(",").join("")));d=parseFloat(parseFloat(d+t).toFixed(2));c=parseFloat(parseFloat(c+f).toFixed(2));l=parseFloat(parseFloat(l+u).toFixed(2))});ft=o>0?parseFloat(parseFloat(c/o*100).toFixed(2)):0;et=o>0?parseFloat(parseFloat(l/o*100).toFixed(2)):0;$("#"+ClientID_MyPortfolio.lblNetworthFiltered).text(formatNumber(d,2,!1));$("#"+ClientID_MyPortfolio.lblOverallGainFiltered).text(formatNumber(c,2,!1)+" ("+formatNumber(ft,4,!0)+"%)");$("#"+ClientID_MyPortfolio.lblDaysGainFiltered).text(formatNumber(l,2,!1)+" ("+formatNumber(et,4,!0)+"%)");w!=""&&$("#"+ClientID_MyPortfolio.marketDate).html("As of "+w)}else console.log("not allowed")}},Calculator={calculatePurchaseAmount:function(n,t,i){var e=parseFloat(parseInt(qty)*parseFloat(rate)),o=parseFloat(0),r,u,f;$.each(i.BrokerCommissionSetting,function(){amount>=this.StartAmount&&amount<=this.EndAmount&&(rate=this.BrokerCommissionRate)});bComm<i.MiniumCommissionAmount&&(bComm=parseFloat(i.MiniumCommissionAmount));r=parseFloat(0);i.SeboCommissionRate.length>0&&(r=i.SeboCommissionRate[0].SeboCommissionRate);u=parseFloat(parseFloat(amount*r).toFixed(2));f=parseFloat()},calculateSalesRevenue:function(n,t,i,r){var u=parseFloat(parseInt(n)*parseFloat(t)),e,f,o,h,s;return u==0?{qty:n,rate:t,amount:u,brokerCommission:0,brokerCommissionRate:0,seboCommission:0,seboCommissionRate:0,revenue:0,capitalGainTax:0}:(e=parseFloat(0),$.each(i.BrokerCommissionRate,function(){u>=this.StartAmount&&u<=this.EndAmount&&(e=this.BrokerCommissionRate)}),f=parseFloat(parseFloat(u*e).toFixed(2)),f<i.MiniumCommissionAmount&&(f=parseFloat(i.MiniumCommissionAmount)),o=parseFloat(0),i.SeboCommissionRate.length>0&&(o=i.SeboCommissionRate[0].SeboCommissionRate),h=parseFloat(parseFloat(u*o).toFixed(2)),s=parseFloat(parseFloat(u-f-h).toFixed(2)),isNaN(r)==!1?s=parseFloat(parseFloat(parseFloat(s)-parseFloat(r)).toFixed(2)):r=parseFloat(0),{qty:n,rate:t,amount:u,brokerCommission:f,brokerCommissionRate:e,seboCommission:h,seboCommissionRate:o,revenue:s,capitalGainTax:r})}}